# 常见问题

## 截图功能异常

### 问题现象
截图功能不工作或生成的截图异常。

### 可能原因及解决方法
1. **浏览器未正确安装**
   - 插件会自动尝试安装浏览器，若安装失败可手动执行：
     ```bash
     playwright install
     ```

2. **网络问题**
   - 请检查网络连接，确保能正常访问目标网站
   - 若使用代理，请确保代理配置正确

3. **权限问题**
   - 确保插件有足够的权限创建临时文件
   - 检查临时目录的写入权限

4. **截图格式设置错误**
   - 请确保使用支持的格式（JPEG或PNG）
   - 检查`screenshot_format`配置项

5. **页面加载问题**
   - 适当增加`screenshot_wait_time`配置值
   - 对于动态加载的网页，可尝试增加等待时间

## 分析结果不准确

### 问题现象
网页分析结果与预期不符。

### 优化建议
1. **调整max_content_length**
   - 增加抓取的内容长度，确保获取完整的网页内容
   - 默认值为10000，可根据实际需求调整

2. **调整截图等待时间**
   - 增加页面加载等待时间，确保动态内容加载完成
   - 默认值为2000毫秒，可适当增加

3. **使用自定义提示词**
   - 通过`custom_prompt`配置自定义提示词
   - 优化提示词可以提高分析结果的准确性

4. **检查代理配置**
   - 如果使用了代理，请确保代理配置正确
   - 代理可能会影响网页内容的获取

5. **确保目标网页可访问**
   - 检查目标网页是否能正常访问
   - 部分网站可能有访问限制

## 插件响应缓慢

### 问题现象
插件处理请求时间过长。

### 优化建议
1. **减少max_content_length**
   - 减少抓取的内容长度，加快处理速度
   - 根据实际需求调整合适的值

2. **关闭不必要的功能**
   - 关闭`screenshot_full_page`选项，只截取可见部分
   - 关闭`enable_screenshot`选项，跳过截图生成

3. **调整请求超时**
   - 合理设置`request_timeout`配置
   - 避免超时时间设置过长

4. **减少重试次数**
   - 减少`retry_count`配置，减少重试次数
   - 默认值为3，可根据网络状况调整

5. **优化缓存设置**
   - 确保`enable_cache`为true，启用缓存功能
   - 适当调整缓存过期时间

## 代理配置问题

### 问题现象
配置代理后无法正常使用。

### 检查要点
1. **代理格式是否正确**
   - 格式应为：`http://username:password@host:port`
   - 确保包含完整的协议头

2. **代理服务器是否可用**
   - 确保代理服务器能正常访问
   - 测试代理服务器的连通性

3. **代理服务器是否支持HTTPS请求**
   - 多数网站使用HTTPS
   - 确保代理支持HTTPS请求

4. **代理认证信息是否正确**
   - 检查用户名和密码是否正确
   - 注意区分大小写

## 缓存功能异常

### 问题现象
缓存不生效或出现异常。

### 解决方法
1. **检查enable_cache配置**
   - 确保`enable_cache`配置为`true`
   - 只有启用缓存才能使用缓存功能

2. **检查cache_expire_time配置**
   - 确保缓存过期时间设置合理（单位：分钟）
   - 默认值为1440分钟（24小时）

3. **手动清理缓存**
   - 使用命令清理缓存：
     ```
     /web_cache clear
     ```
   - 清理后重新测试

4. **检查缓存目录权限**
   - 确保缓存目录有写入权限
   - 检查文件系统权限设置

5. **查看日志文件**
   - 排查具体错误信息
   - 日志中可能包含缓存相关的错误

## 多链接处理问题

### 问题现象
同时发送多个链接时处理异常。

### 解决方法
1. **检查merge_forward_enabled配置**
   - 确保合并转发功能正常启用
   - 分别检查群聊和私聊的配置

2. **减少单次发送的链接数量**
   - 建议每次发送不超过10个链接
   - 过多的链接可能导致处理超时

3. **确保服务器资源充足**
   - 多链接处理需要更多的系统资源
   - 确保服务器有足够的内存和CPU资源

## 分析模式切换问题

### 问题现象
无法切换分析模式或模式切换后不生效。

### 解决方法
1. **检查命令权限**
   - 切换模式命令仅管理员可用
   - 确保使用管理员账号执行命令

2. **检查命令格式**
   - 命令格式应为：`/web_mode <mode>`
   - 可用模式：auto、manual、hybrid、LLMTOOL

3. **重启插件**
   - 模式切换后可尝试重启插件
   - 或在WebUI中重载插件

4. **检查配置文件**
   - 查看配置文件中的`analysis_mode`配置项
   - 确保配置值正确

## 翻译功能异常

### 问题现象
翻译功能不工作或翻译结果不准确。

### 解决方法
1. **检查enable_translation配置**
   - 确保`enable_translation`配置为`true`
   - 只有启用翻译才能使用翻译功能

2. **检查target_language配置**
   - 确保目标语言设置正确
   - 默认值为"zh"（中文）

3. **检查translation_provider配置**
   - 确保翻译提供商设置正确
   - 目前支持"llm"提供商

4. **使用自定义翻译提示词**
   - 通过`custom_translation_prompt`配置自定义翻译提示词
   - 优化提示词可以提高翻译质量

## 域名过滤问题

### 问题现象
某些域名的链接无法分析或被错误过滤。

### 解决方法
1. **检查allowed_domains配置**
   - 若设置了允许的域名列表，确保目标域名在列表中
   - 留空表示允许所有域名

2. **检查blocked_domains配置**
   - 确保目标域名不在禁止的域名列表中
   - 禁止列表优先级高于允许列表

3. **检查enable_unified_domain配置**
   - 启用域名统一处理后，google.com和www.google.com视为同一域名
   - 根据实际需求调整该配置

4. **检查URL格式**
   - 确保URL格式正确
   - 对于无协议头的URL，确保`enable_no_protocol_url`为true

## 插件安装问题

### 问题现象
插件安装失败或无法正常加载。

### 解决方法
1. **检查Python版本**
   - 确保Python版本为3.10+ 
   - 旧版本Python可能不兼容

2. **检查依赖安装**
   - 确保所有依赖已正确安装
   - 重新执行`pip install -r requirements.txt`

3. **检查目录结构**
   - 确保插件目录结构正确
   - 目录应位于AstrBot的plugins目录下

4. **查看日志文件**
   - 检查AstrBot日志，查找插件加载错误
   - 日志中可能包含具体的错误信息

5. **检查插件元数据**
   - 确保metadata.yaml文件存在且格式正确
   - 检查插件名称、版本等信息

## 命令不生效

### 问题现象
输入命令后无响应或提示错误。

### 解决方法
1. **检查命令格式**
   - 确保命令格式正确
   - 命令名称不区分大小写

2. **检查命令权限**
   - 部分命令仅管理员可用
   - 确保使用正确的账号执行命令

3. **检查命令别名**
   - 尝试使用其他命令别名
   - 例如：/分析、/总结、/web等

4. **检查分析模式**
   - 在manual模式下，需要手动触发分析
   - 确保模式设置正确

5. **查看帮助信息**
   - 输入`/web_help`查看所有可用命令
   - 确认命令名称和参数

## 内存占用过高

### 问题现象
插件运行一段时间后内存占用过高。

### 解决方法
1. **检查缓存设置**
   - 适当减少`max_cache_size`配置
   - 减少缓存项数量

2. **关闭不必要的功能**
   - 关闭`screenshot_full_page`选项
   - 关闭`enable_screenshot`选项

3. **调整并发数**
   - 减少同时处理的URL数量
   - 避免资源过度占用

4. **检查浏览器池配置**
   - 浏览器池会占用一定的内存
   - 确保浏览器实例及时释放

5. **重启插件**
   - 定期重启插件可以释放内存
   - 或在WebUI中重载插件

## 日志问题

### 问题现象
无法查看日志或日志信息不完整。

### 解决方法
1. **检查日志配置**
   - 确保日志级别设置正确
   - 建议设置为DEBUG或INFO级别

2. **查看AstrBot日志**
   - 插件日志会写入AstrBot的日志文件
   - 检查AstrBot日志目录

3. **检查日志权限**
   - 确保日志文件有写入权限
   - 检查文件系统权限设置

4. **启用详细日志**
   - 在配置中启用详细日志记录
   - 便于排查问题

## 其他问题

### 问题现象
遇到其他未列出的问题。

### 解决方法
1. **查看最新版本**
   - 检查是否有新版本发布
   - 新版本可能已修复该问题

2. **查看更新日志**
   - 检查CHANGELOG.md文件
   - 了解最近的更新内容

3. **提交Issue**
   - 在GitHub上提交Issue
   - 提供详细的问题描述和日志

4. **联系开发者**
   - 通过GitHub或其他渠道联系开发者
   - 寻求技术支持

5. **重启AstrBot**
   - 尝试重启AstrBot，可能解决临时问题

## 最佳实践

1. **定期更新插件**
   - 关注插件更新，及时升级到最新版本
   - 新版本可能包含性能优化和bug修复

2. **合理配置插件**
   - 根据实际需求调整配置
   - 避免启用不必要的功能

3. **监控插件运行状态**
   - 定期查看日志
   - 监控系统资源使用

4. **测试新功能**
   - 新功能上线后进行测试
   - 确保功能正常工作

5. **提供反馈**
   - 遇到问题及时反馈
   - 帮助开发者改进插件

## 常见错误代码

| 错误代码 | 说明 | 解决方法 |
|----------|------|----------|
| 400 | URL格式错误 | 检查URL格式，确保URL正确 |
| 403 | 访问被拒绝 | 检查域名是否在禁止列表中，或目标网站有访问限制 |
| 404 | 页面未找到 | 检查目标URL是否存在，或网站结构已变更 |
| 500 | 服务器错误 | 目标网站内部错误，稍后重试 |
| 502 | 网关错误 | 代理或网关错误，检查网络连接 |
| 503 | 服务不可用 | 目标网站暂时不可用，稍后重试 |
| 504 | 网关超时 | 代理或网关超时，检查网络连接 |

## 联系方式

- GitHub: [https://github.com/Sakura520222/astrbot_plugin_web_analyzer](https://github.com/Sakura520222/astrbot_plugin_web_analyzer)
- Issues: [https://github.com/Sakura520222/astrbot_plugin_web_analyzer/issues](https://github.com/Sakura520222/astrbot_plugin_web_analyzer/issues)

如果您遇到的问题不在上述列表中，或者您需要进一步的帮助，请随时提交Issue或联系开发者。